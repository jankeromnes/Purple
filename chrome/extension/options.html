<html>
<head><title>Purple Extension Options</title></head>
<style>
body {
  font-family:Verdana,Geneva,sans-serif;
}

</style>

<script type="text/javascript">

// Synchronize the checkbox and disabled states
function syncOptions(checkit) {
  var dogfoodURL = document.getElementById('dogfoodURL');
  var dogfood = document.getElementById('dogfood');
  if (!checkit) {
    dogfood.setAttribute('checked', 'checked');
    dogfoodURL.removeAttribute('disabled');
  } else {
    dogfood.removeAttribute('checked');
    dogfoodURL.setAttribute('disabled', 'disabled');
  }
}

// Saves options to localStorage.
function save_options() {
  var messageClientURL = document.getElementById("messageClientURL");
  var url = messageClientURL.value;
  localStorage.setItem("messageClientURL", url);

  var dogfoodURL = document.getElementById('dogfoodURL');
  url = dogfoodURL.value.trim() || url;
  localStorage.setItem('dogfoodURL', url);

  var dogfoodCheckbox = document.getElementById('dogfood');
  localStorage.setItem('dogfood', (dogfoodCheckbox.hasAttribute('checked') ? dogfoodCheckbox.value : false));

  // Update status to let user know options were saved.
  var status = document.getElementById("status");
  status.innerHTML = "Options Saved.";
  setTimeout(function() {
    status.innerHTML = "";
  }, 750);
}

// Restores messageClientURL box state to saved value from localStorage.
function restore_options() {
  var url = localStorage.getItem('messageClientURL');
  if (!url) {
    return;
  }
  var messageClientURL = document.getElementById("messageClientURL");
  messageClientURL.value = url;

  var dogfoodURL = document.getElementById('dogfoodURL');
  dogfoodURL.value = localStorage.getItem('dogfoodURL') || "";

  var dogfood = document.getElementById('dogfood');
  var checkit = localStorage.getItem('dogfood');
  syncOptions(checkit);
}

function onLoad() {
  restore_options();
  var dogFoodItems = document.getElementById('dogfoodItems');
  dogFoodItems.addEventListener('click', function(event) {
    var target = event.target;
    syncOptions(target.hasAttribute('checked'));
  }, false);
}

</script>

<body onload="onLoad()">

<p>
In this prototype, Purple is a Web Application running in an iframe in an extension.
Events from the Chrome browser are handled by the extension then sent by postMessage() to the iframe. Commands from the iframe sent by postMessage() to the extension which sends them to Chrome.
Until we  have a deployed version of Purple you will need to set the URL below to point to your git clone file <code>purple.html</code>
</p>


Development Tool URL:
<div id='clientItems'>
<input id="messageClientURL" type='url' size='80' />
</div>

<div id='dogfoodItems'>
<input id='dogfood' type='checkbox' checked value='dogfood'/>
Dogfood URL (blank to use the same URL in dogfood mode)<br>
<input id='dogfoodURL' type='url' size='80' disabled />
</div>
<br>
<button onclick="save_options()">Save</button>
<div id="status"></div>
</body>
</html>
